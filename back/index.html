<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Task Manager - –ü–ó ‚Ññ5</title>
    <style>
        /* ============================================
           Simple Task Manager - Web UI
           –ü—Ä–∞–∫—Ç–∏—á–Ω–∞ —Ä–æ–±–æ—Ç–∞ ‚Ññ5
           –°—Ç—É–¥–µ–Ω—Ç: –ú–∞–ª–∏–π –î.–î., –ö–ù–¢-22-4
           ============================================ */
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 0.9em;
        }
        
        /* ============================================
           –°—Ç–∏–ª—ñ —Ñ–æ—Ä–º–∏
           ============================================ */
        .task-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .full-width {
            grid-column: span 2;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 60px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        /* ============================================
           –°—Ç–∏–ª—ñ —Ç–∞–±–ª–∏—Ü—ñ
           ============================================ */
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: #f8f9fa;
            color: #555;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.5px;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        /* ============================================
           –ë–µ–π–¥–∂—ñ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç—ñ–≤ (–∫–æ–ª—å–æ—Ä–æ–≤–∞ —ñ–Ω–¥–∏–∫–∞—Ü—ñ—è)
           ============================================ */
        .badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
            color: white;
            display: inline-block;
        }
        
        .p-High {
            background-color: #e74c3c;
        }
        
        .p-Medium {
            background-color: #f1c40f;
            color: #333;
        }
        
        .p-Low {
            background-color: #27ae60;
        }
        
        /* –°—Ç–∞—Ç—É—Å–∏ */
        .s-Pending {
            color: #f39c12;
        }
        
        .s-In_Progress {
            color: #3498db;
        }
        
        .s-Completed {
            color: #27ae60;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ –¥—ñ–π */
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-start {
            background-color: #3498db;
            color: white;
        }
        
        .btn-start:hover {
            background-color: #2980b9;
        }
        
        .btn-complete {
            background-color: #27ae60;
            color: white;
        }
        
        .btn-complete:hover {
            background-color: #1e8449;
        }
        
        .completed-label {
            color: #27ae60;
            font-weight: 500;
        }
        
        /* ============================================
           –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (toast)
           ============================================ */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        .toast.success {
            background-color: #27ae60;
        }
        
        .toast.error {
            background-color: #e74c3c;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* ============================================
           –ü–æ—Ä–æ–∂–Ω—ñ–π —Å—Ç–∞–Ω
           ============================================ */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #95a5a6;
        }
        
        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 15px;
        }
        
        /* ============================================
           –§—É—Ç–µ—Ä
           ============================================ */
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #95a5a6;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã Simple Task Manager</h1>
        <p class="subtitle">–ü—Ä–∞–∫—Ç–∏—á–Ω–∞ —Ä–æ–±–æ—Ç–∞ ‚Ññ5 ‚Äî –ö–æ–º–ø–ª–µ–∫—Å—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å–Ω–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏<br>
        –°—Ç—É–¥–µ–Ω—Ç: –ú–∞–ª–∏–π –î.–î., –ö–ù–¢-22-4</p>
        
        <!-- ============================================
             –§–æ—Ä–º–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è
             ============================================ -->
        <div class="task-form">
            <div class="full-width">
                <label for="title">–ù–∞–∑–≤–∞ –∑–∞–≤–¥–∞–Ω–Ω—è *</label>
                <input type="text" id="title" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –∑–∞–≤–¥–∞–Ω–Ω—è..." required>
            </div>
            
            <div class="full-width">
                <label for="desc">–û–ø–∏—Å</label>
                <textarea id="desc" placeholder="–î–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –∑–∞–≤–¥–∞–Ω–Ω—è..." rows="2"></textarea>
            </div>
            
            <div>
                <label for="category">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                <select id="category">
                    <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>
                </select>
            </div>
            
            <div>
                <label for="priority">–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç</label>
                <select id="priority">
                    <option value="Low">üü¢ Low (–ù–∏–∑—å–∫–∏–π)</option>
                    <option value="Medium" selected>üü° Medium (–°–µ—Ä–µ–¥–Ω—ñ–π)</option>
                    <option value="High">üî¥ High (–í–∏—Å–æ–∫–∏–π ‚Äî Auto Reminder)</option>
                </select>
            </div>
            
            <div class="full-width">
                <label for="dueDate">–î–µ–¥–ª–∞–π–Ω</label>
                <input type="datetime-local" id="dueDate">
            </div>
            
            <button class="full-width" id="submitBtn" onclick="createTask()">
                ‚ûï –î–æ–¥–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è
            </button>
        </div>

        <!-- ============================================
             –¢–∞–±–ª–∏—Ü—è –∑–∞–≤–¥–∞–Ω—å (–¥–∞—à–±–æ—Ä–¥)
             ============================================ -->
        <h2>üìä –ú–æ—ó –∑–∞–≤–¥–∞–Ω–Ω—è</h2>
        <table id="tasksTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–ù–∞–∑–≤–∞</th>
                    <th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th>
                    <th>–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–¥–ª–∞–π–Ω</th>
                    <th>–î—ñ—ó</th>
                </tr>
            </thead>
            <tbody id="tasksBody">
                <!-- –ó–∞–≤–¥–∞–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ -->
            </tbody>
        </table>
        
        <div class="footer">
            Simple Task Manager v2.0.0 | –°–û–ê–ü–° –ü–ó ‚Ññ5 | –•–ù–£–†–ï 2025
        </div>
    </div>

    <!-- ============================================
         JavaScript - –õ–æ–≥—ñ–∫–∞ –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ API
         ============================================ -->
    <script>
        // –ë–∞–∑–æ–≤–∞ URL-–∞–¥—Ä–µ—Å–∞ API (–±–µ–∫–µ–Ω–¥ –Ω–∞ FastAPI)
        const API_URL = 'http://127.0.0.1:8000';

        /**
         * –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–æ–¥–∞—Ç–∫—É –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
         */
        async function init() {
            try {
                // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –¥–ª—è –≤–∏–ø–∞–¥–∞—é—á–æ–≥–æ —Å–ø–∏—Å–∫—É
                const cats = await fetch(`${API_URL}/categories`).then(r => r.json());
                const catSelect = document.getElementById('category');
                
                cats.forEach(c => {
                    const option = document.createElement('option');
                    option.value = c.idCategory;
                    option.textContent = c.CategoryName;
                    catSelect.appendChild(option);
                });
                
                // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –∑–∞–≤–¥–∞–Ω—å
                await loadTasks();
            } catch (error) {
                showToast('–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞!', 'error');
                console.error('Init error:', error);
            }
        }

        /**
         * –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –∑–∞–≤–¥–∞–Ω—å
         */
        async function loadTasks() {
            try {
                const tasks = await fetch(`${API_URL}/tasks`).then(r => r.json());
                const tbody = document.getElementById('tasksBody');
                tbody.innerHTML = '';
                
                if (tasks.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="empty-state">
                                <div>üì≠</div>
                                <p>–ó–∞–≤–¥–∞–Ω—å –ø–æ–∫–∏ –Ω–µ–º–∞—î. –°—Ç–≤–æ—Ä—ñ—Ç—å –ø–µ—Ä—à–µ!</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tasks.forEach(t => {
                    const date = t.DueDate 
                        ? new Date(t.DueDate).toLocaleString('uk-UA') 
                        : '‚Äî';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>#${t.idTask}</strong></td>
                        <td>${escapeHtml(t.Title)}</td>
                        <td>${t.CategoryName || '<em>–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</em>'}</td>
                        <td><span class="badge p-${t.Priority}">${t.Priority}</span></td>
                        <td class="s-${t.Status}">${formatStatus(t.Status)}</td>
                        <td>${date}</td>
                        <td>${getActionButtons(t.idTask, t.Status)}</td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                showToast('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞–≤–¥–∞–Ω—å', 'error');
                console.error('Load tasks error:', error);
            }
        }

        /**
         * –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è —á–µ—Ä–µ–∑ POST /tasks
         */
        async function createTask() {
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('desc').value.trim();
            const category = document.getElementById('category').value;
            const priority = document.getElementById('priority').value;
            const dueDate = document.getElementById('dueDate').value;
            
            // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –Ω–∞ –∫–ª—ñ—î–Ω—Ç—ñ
            if (!title || title.length < 3) {
                showToast('–ù–∞–∑–≤–∞ –∑–∞–≤–¥–∞–Ω–Ω—è –º–∞—î –±—É—Ç–∏ –Ω–µ –º–µ–Ω—à–µ 3 —Å–∏–º–≤–æ–ª—ñ–≤!', 'error');
                return;
            }
            
            // –§–æ—Ä–º—É–≤–∞–Ω–Ω—è JSON-–æ–±'—î–∫—Ç–∞ –¥–ª—è API
            const payload = {
                user_id: 1, // –•–∞—Ä–¥–∫–æ–¥ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è (–∑–∞–≥–ª—É—à–∫–∞)
                title: title,
                description: description,
                category_id: category ? parseInt(category) : null,
                priority: priority,
                due_date: dueDate || null
            };

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è...';

            try {
                const resp = await fetch(`${API_URL}/tasks`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                
                const data = await resp.json();
                
                if (resp.ok && data.success) {
                    showToast(`‚úÖ ${data.message} (ID: ${data.task_id})`, 'success');
                    
                    // –û—á–∏—â–µ–Ω–Ω—è —Ñ–æ—Ä–º–∏
                    document.getElementById('title').value = '';
                    document.getElementById('desc').value = '';
                    document.getElementById('dueDate').value = '';
                    
                    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ
                    await loadTasks();
                } else {
                    const errorMsg = data.detail || data.message || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞';
                    showToast(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${errorMsg}`, 'error');
                }
            } catch (e) {
                showToast('‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π!', 'error');
                console.error('Create task error:', e);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '‚ûï –î–æ–¥–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è';
            }
        }

        /**
         * –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è toast-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
         */
        function showToast(message, type = 'success') {
            // –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
            document.querySelectorAll('.toast').forEach(t => t.remove());
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥–∏
            setTimeout(() => toast.remove(), 4000);
        }

        /**
         * –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
         */
        function formatStatus(status) {
            const statusMap = {
                'Pending': '‚è≥ –û—á—ñ–∫—É—î',
                'In_Progress': 'üîÑ –í —Ä–æ–±–æ—Ç—ñ',
                'Completed': '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ'
            };
            return statusMap[status] || status;
        }

        /**
         * –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–Ω–æ–ø–æ–∫ –¥—ñ–π –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å—É
         */
        function getActionButtons(taskId, status) {
            if (status === 'Completed') {
                return '<span class="completed-label">‚úì –í–∏–∫–æ–Ω–∞–Ω–æ</span>';
            }
            
            const nextStatus = status === 'Pending' ? 'In_Progress' : 'Completed';
            const btnText = status === 'Pending' ? '‚ñ∂ –ü–æ—á–∞—Ç–∏' : '‚úì –ó–∞–≤–µ—Ä—à–∏—Ç–∏';
            const btnClass = status === 'Pending' ? 'btn-start' : 'btn-complete';
            
            return `<button class="action-btn ${btnClass}" onclick="changeStatus(${taskId}, '${nextStatus}')">${btnText}</button>`;
        }

        /**
         * –ó–º—ñ–Ω–∞ —Å—Ç–∞—Ç—É—Å—É –∑–∞–≤–¥–∞–Ω–Ω—è —á–µ—Ä–µ–∑ PATCH /tasks/{id}/status
         */
        async function changeStatus(taskId, newStatus) {
            try {
                const resp = await fetch(`${API_URL}/tasks/${taskId}/status?new_status=${newStatus}`, {
                    method: 'PATCH'
                });
                
                const data = await resp.json();
                
                if (resp.ok && data.success) {
                    showToast(`‚úÖ ${data.message}`, 'success');
                    await loadTasks();
                } else {
                    showToast(`‚ùå –ü–æ–º–∏–ª–∫–∞: ${data.detail || data.message}`, 'error');
                }
            } catch (e) {
                showToast('‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π!', 'error');
                console.error('Change status error:', e);
            }
        }

        /**
         * –ï–∫—Ä–∞–Ω—É–≤–∞–Ω–Ω—è HTML –¥–ª—è –±–µ–∑–ø–µ–∫–∏
         */
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // –ó–∞–ø—É—Å–∫ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
